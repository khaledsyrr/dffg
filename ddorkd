// سكربت شات مدى - نسخة مطورة
(function() {
  // تأكد من وجود jQuery
  if (typeof jQuery === 'undefined') {
    console.error('هذا السكربت يتطلب jQuery. الرجاء تحميل jQuery أولاً.');
    return;
  }
  
 
    
    // تعديل خطوط الموقع
    $(".primaryborder").css({
      "font-family": "Ruqaa, FontAwesome",
      "font-size": "16px"
    });
    
    $("body, [style*='font-family:-apple-system;'], div, #d2, #pass1, #pass2, #u1, #u2, #u3").css({
      "font-family": "Ruqaa, sans-serif",
      "font-size": "16px"
    });
    
    // إضافة مربع رسائل ترحيبي - تم تحسين التنسيق
   
    
    // إضافة زر للتحكم بصوت المايكات - تم تكبير الحجم
    $('<span class="fa fa-microphone control-button" style="font-family: FontAwesome, sans-serif; font-size: 18px; margin: 0 5px; padding: 5px; cursor: pointer;"></span>').insertBefore('.nav-tabs');
    
    // إضافة زر للتحكم بالمايكات - تم تكبير الحجم
    $('<div class="mic-control" style="display: flex; align-items: center; margin: 10px 0; padding: 8px; background-color: #f0f0f0; border-radius: 10px;">\
      <span class="fa fa-microphone-slash" style="font-family: FontAwesome, sans-serif; font-size: 18px; margin-right: 8px;"></span>\
      <span style="font-size: 16px;">التحكم بصوت مايكات الغرفة</span>\
    </div>').insertBefore('img.co.u-pic[src="sico/z1d9cqu9vt10.png"]');
    
    // إضافة ستايل للخطوط - تم تحسين التأثير
    $('<style>\
      @keyframes sparkle {\
        0% {background-position: 0% 50%; transform: scale(1);}\
        50% {background-position: 100% 50%; transform: scale(1.05);}\
        100% {background-position: 0% 50%; transform: scale(1);}\
      }\
      .fa.fa-user.label.label-primary.fa-user-plus, .fa.fa-user.label.label-primary {\
        color: transparent !important;\
        background-color: transparent !important;\
        font-size: 16px !important;\
        background-image: linear-gradient(90deg, #007bff, #00FFFF, #FFD700, #007bff);\
        background-size: 300% 100%;\
        -webkit-background-clip: text;\
        animation: sparkle 4s ease-in-out infinite;\
        border: 0px !important;\
        font-family: jazeera !important;\
        padding: 8px 12px !important;\
        margin: 5px !important;\
        display: inline-block !important;\
      }\
    </style>').appendTo('head');
    
    // إضافة ستايل للرسائل - تم تحسين التأثير
    $('<style>\
      @keyframes messageSparkle {\
        0% {background-position: 0% 50%;}\
        50% {background-position: 100% 50%;}\
        100% {background-position: 0% 50%;}\
      }\
      .u-msg.emoi.uzr.fl.spanable:not([style*="color:rgb"]) {\
        color: transparent !important;\
        margin: 5px !important;\
        font-size: 16px !important;\
        font-weight: bold !important;\
        letter-spacing: 1px;\
        text-transform: uppercase;\
        background-image: linear-gradient(90deg, #007bff, #00FFFF, #FFD700, #007bff);\
        background-size: 300% 100%;\
        -webkit-background-clip: text;\
        animation: messageSparkle 4s ease-in-out infinite;\
        padding: 5px !important;\
        border-radius: 8px !important;\
      }\
    </style>').appendTo('body');
    
    // تحديث الصور
    function updateImages() {
      $('img.co.u-pic[src="sico/z1d9cqu9vt10.png"]').attr('src', 'https://madahost.online/sico/1745769546196.gif');
      $('img.co.u-pic[src="sico/jo.png"]').attr('src', 'https://madahost.online/sico/1738506623066.gif');
      $('img.u-ico').attr('src', 'https://madahost.online/sico/1738506624947.gif');
    }
    
    // تحديث الصور مباشرة وكل 2 ثانية
    updateImages();
    setInterval(updateImages, 2000);
    
    // إضافة زر لتغيير نمط العرض - تم تكبير الحجم وتحسين المظهر
    let isDesktopView = false;
    let viewButton = $("<button>عرض الهاتف</button>").addClass("btn border view-toggle-btn").css({
      "background-color": "#f0f0f0",
      "color": "#333",
      "padding": "10px 15px",
      "margin": "8px",
      "width": "45%",
      "font-size": "16px",
      "border-radius": "10px",
      "box-shadow": "0 2px 5px rgba(0,0,0,0.1)",
      "transition": "all 0.3s ease"
    }).append('<span class="fa fa-mobile" style="margin-right: 5px; font-size: 18px;"></span>').click(function() {
      if (isDesktopView) {
        $('meta[name="viewport"]').attr('content', 'width=device-width, initial-scale=1.0');
        $(this).html("عرض الهاتف").append('<span class="fa fa-mobile" style="margin-right: 5px; font-size: 18px;"></span>');
        $(this).css("background-color", "#f0f0f0");
        isDesktopView = false;
        alert("تم العودة إلى الوضع الطبيعي");
      } else {
        $('meta[name="viewport"]').attr('content', 'width=1024');
        $(this).html("عرض سطح المكتب").append('<span class="fa fa-desktop" style="margin-right: 5px; font-size: 18px;"></span>');
        $(this).css("background-color", "#e0e0e0");
        isDesktopView = true;
        alert("تم تحويل العرض إلى وضع الكمبيوتر");
      }
    });
    
    // إضافة تأثير hover للزر
    viewButton.hover(
      function() { $(this).css("background-color", "#e0e0e0"); },
      function() { $(this).css("background-color", isDesktopView ? "#e0e0e0" : "#f0f0f0"); }
    );
    
    $(".primaryborder").append(viewButton);
    
    // إضافة تأثير عند النقر على العناصر - تم تحسين التأثير
    $(document).on('click', 'button', function(e) {
      // إضافة تأثير نقطة عند النقر
      let ripple = $('<span class="heart-ripple">&#10084;</span>');
      $(this).css('position', 'relative');
      
      let offset = $(this).offset();
      let relativeX = e.pageX - offset.left;
      let relativeY = e.pageY - offset.top;
      
      ripple.css({
        'top': relativeY - 10 + 'px',
        'left': relativeX - 10 + 'px',
        'position': 'absolute',
        'font-size': '20px',
        'color': '#ff6b6b'
      });
      
      $(this).append(ripple);
      
      setTimeout(function() {
        ripple.fadeOut(300, function() {
          $(this).remove();
        });
      }, 800);
    });
    
    // تعديل نص الأزرار وتكبير حجمها
    $("button.btn.btn-primary").html("دخول").css({
      "font-size": "18px",
      "padding": "10px 20px",
      "margin": "8px",
      "border-radius": "10px"
    });
    
    // تعديل أيقونات الأزرار وتكبير حجمها
    $('button.fa.fa-send.fl.btn.btn-primary').html(function(a, b) {
      return '<span style="font-family: \'Ruqaa\', FontAwesome; font-size: 16px;">' + $(this).html() + '</span>';
    }).css({
      "padding": "10px 15px",
      "margin": "5px",
      "border-radius": "10px"
    });
    
    
    
    $('.fa.fa-send.fl.fa-mute-mic').each(function() {
      let a = $(this).html();
      $(this).html('<span style="font-family: \'Ruqaa\', FontAwesome; font-size: 16px;">' + a + '</span>');
    });
    
    // تعديل خط الرسائل وتكبير حجمها
    $(".u-msg.break.fl").css({
      "font-family": "Ruqaa, FontAwesome",
      "font-size": "16px",
      "padding": "8px",
      "margin": "5px",
      "border-radius": "8px"
    });
    
    // إضافة أزرار للتحكم بالخطوط والمظهر - تم تكبير الحجم وتحسين المظهر
    let isEmojisHidden = false;
    let fontButton = $("<button>إخفاء/إظهار العناصر</button>").addClass("btn label border control-btn").css({
      "background-color": "#f0f0f0",
      "color": "#800000",
      "padding": "10px 15px",
      "margin": "8px",
      "width": "45%",
      "font-size": "16px",
      "border-radius": "10px",
      "box-shadow": "0 2px 5px rgba(0,0,0,0.1)",
      "transition": "all 0.3s ease"
    }).append('<span class="fa fa-smile-o" style="margin-right: 5px; font-size: 18px;"></span>').click(function() {
      isEmojisHidden = !isEmojisHidden;
      if (isEmojisHidden) {
        $(".emobc").show();
        $(this).html("إخفاء العناصر التعبيرية").append('<span class="fa fa-smile-o" style="margin-right: 5px; font-size: 18px;"></span>');
        $(this).css("background-color", "#e0e0e0");
      } else {
        $(".emobc").hide();
        $(this).html("إظهار العناصر التعبيرية").append('<span class="fa fa-smile-o" style="margin-right: 5px; font-size: 18px;"></span>');
        $(this).css("background-color", "#f0f0f0");
      }
    });
    
    // إضافة تأثير hover للزر
    fontButton.hover(
      function() { $(this).css("background-color", "#e0e0e0"); },
      function() { $(this).css("background-color", isEmojisHidden ? "#e0e0e0" : "#f0f0f0"); }
    );
    
    $(".primaryborder").append(fontButton);
    
    // إضافة أزرار لتغيير الخطوط - تم تحسين المظهر وتكبير الحجم
    let fonts = [
      {'name': 'الخط الافتراضي', 'css': ''},
      {'name': 'خط الجزيرة', 'css': '@import url(\'https://fonts.googleapis.com/css2?family=Aref+Ruqaa:wght@400;700&display=swap\'); .bg.mini, .mini.u-msg { font-family: \'Aref Ruqaa\', FontAwesome !important; font-weight: bold !important; font-size: 16px !important; }'},
      {'name': 'خط اللطيف', 'css': '@import url(\'https://fonts.googleapis.com/css2?family=Lateef:wght@400;700&display=swap\'); .bg.mini, .mini.u-msg { font-family: \'Lateef\', FontAwesome !important; font-weight: bold !important; font-size: 16px !important; }'},
      {'name': 'خط آيفون', 'css': '@import url(\'https://fonts.googleapis.com/css2?family=Tajawal:wght@400;700&display=swap\'); .bg.mini, .mini.u-msg { font-family: \'Tajawal\', sans-serif !important; font-weight: bold !important; font-size: 16px !important; }'},
      {'name': 'خط الكوفي', 'css': '@import url(\'https://fonts.googleapis.com/css2?family=Reem+Kufi:wght@400;700&display=swap\'); .bg.mini, .mini.u-msg { font-family: \'Reem Kufi\', sans-serif !important; font-weight: bold !important; font-size: 16px !important; }'},
      {'name': 'خط أميري', 'css': '@import url(\'https://fonts.googleapis.com/css2?family=Amiri:wght@400;700&display=swap\'); .bg.mini, .mini.u-msg { font-family: \'Amiri\', FontAwesome !important; font-weight: bold !important; font-size: 16px !important; }'},
      {'name': 'خط تجوال', 'css': '@import url(\'https://fonts.googleapis.com/css2?family=Mirza:wght@400;700&display=swap\'); .bg.mini, .mini.u-msg { font-family: \'Mirza\', Ruqaa !important; font-weight: bold !important; font-size: 16px !important; }'}
    ];
    
    let currentFont = 0;
    let styleTag = $("<style>").attr("type", "text/css").attr("id", "fontStyle").appendTo("head");
    
    let fontSwitcher = $("<button>").html("تغيير الخط إلى: " + fonts[0]["name"]).addClass("btn border font-switcher").css({
      "background-color": "#f0f0f0",
      "color": "#800000",
      "padding": "12px 15px",
      "margin": "10px 8px",
      "width": "95%",
      "font-size": "16px",
      "border-radius": "10px",
      "box-shadow": "0 2px 5px rgba(0,0,0,0.1)",
      "transition": "all 0.3s ease",
      "display": "flex",
      "align-items": "center",
      "justify-content": "center"
    }).append("<span class=\"fa fa-font\" style=\"margin-right: 8px; font-size: 18px;\"></span>").click(function() {
      currentFont = (currentFont + 1) % fonts.length;
      styleTag.html(fonts[currentFont]["css"]);
      let nextFontName = fonts[(currentFont + 1) % fonts.length]["name"];
      $(this).html(currentFont === 0 ? "إعادة الخط الافتراضي" : "تغيير الخط إلى: " + nextFontName).append("<span class=\"fa fa-font\" style=\"margin-right: 8px; font-size: 18px;\"></span>");
    });
    
   
    
    // إضافة زر لمسح الرسائل - تم تكبير الحجم
    $('<img src="https://madahost.online/sico/nc.jpg" alt="مسح الرسائل" style="width:20px; height:20px; margin: 5px; border-radius: 50%; box-shadow: 0 2px 5px rgba(0,0,0,0.1);">').insertBefore('label.nosel.ninr.fl.uzr.label.label-primary');
    
    // إضافة ستايل للأيقونات - تم تحسين التأثير
    $('<style>\
    .heart-ripple {\
      display: block;\
      font-size: 20px;\
      margin: 2px;\
      background: transparent;\
      border-radius: 50%;\
      opacity: 0.8;\
      transform: scale(1);\
      z-index: 999;\
      color: #ff6b6b;\
      text-shadow: 0 0 5px rgba(255,107,107,0.5);\
    }\
    \
    @keyframes sparkle {\
      0% {\
        transform: scale(1) translate(0);\
        opacity: 1;\
      }\
      50% {\
        transform: scale(1.6) translate(-30px);\
        opacity: 0.8;\
      }\
      100% {\
        transform: scale(1) translate(-60px);\
        opacity: 0;\
      }\
    }\
    \
    /* تنسيق الأيقونات */\
    .fa {\
      font-size: 18px !important;\
      margin: 0 5px !important;\
    }\
    </style>').appendTo('head');
    
    // إضافة زر لمسح الرسائل - تم تحسين المظهر والوظيفة
    $(".fa-trash-o").css({
      "padding": "8px",
      "margin": "5px",
      "font-size": "18px",
      "cursor": "pointer",
      "color": "#d9534f",
      "background-color": "#f8f8f8",
      "border-radius": "50%",
      "box-shadow": "0 2px 5px rgba(0,0,0,0.1)",
      "transition": "all 0.3s ease"
    }).hover(
      function() { $(this).css({"background-color": "#f0f0f0", "transform": "scale(1.1)"}); },
      function() { $(this).css({"background-color": "#f8f8f8", "transform": "scale(1)"}); }
    ).click(function(e) {
      e.preventDefault();
      if(confirm('عنجد بتمسح ولا بتمزح')) {
        try {
          let a = $(this).attr("onclick");
          if (a && a.match(/{bid:'([^']+)'}/)) {
            let bid = a.match(/{bid:'([^']+)'}/)[1];
            if (window.socket && typeof window.socket.emit === 'function') {
              window.socket.emit("SEND_EVENT_EMIT_DEL_BC", {'bid': bid});
            } else {
              console.warn("socket غير متوفر");
            }
          }
        } catch(e) {
          console.error("حدث خطأ في مسح الرسالة:", e);
        }
      } else {
        console.warn('تم إلغاء الحذف');
      }
    });
    
    // إضافة زر للتحكم بالصوت - تم تحسين المظهر
    $(".fa-volume-up").css({
      "padding": "8px",
      "margin": "5px",
      "font-size": "18px",
      "cursor": "pointer",
      "color": "#5cb85c",
      "background-color": "#f8f8f8",
      "border-radius": "50%",
      "box-shadow": "0 2px 5px rgba(0,0,0,0.1)",
      "transition": "all 0.3s ease"
    }).hover(
      function() { $(this).css({"background-color": "#f0f0f0", "transform": "scale(1.1)"}); },
      function() { $(this).css({"background-color": "#f8f8f8", "transform": "scale(1)"}); }
    ).append('<img role="sendImageButton" src="https://madahost.online/sico/1740206278289.jpg" style="width:16px; height:16px; opacity:0.9; margin-left: 5px;">');
    
    $(".fa-volume-up").on('click', function() {
      if (window.Muteall && typeof window.Muteall === 'function') {
        window.Muteall(true);
      } else {
        console.warn("وظيفة Muteall غير متوفرة");
      }
    });
    
    // تقصير الرسائل الطويلة - تم تحسين الوظيفة
    let maxLength = 200;
    $('.u-msg').on('input', function() {
      let currentLength = $(this).val().length;
      if (currentLength > maxLength) {
        $(this).val($(this).val().substring(0, maxLength));
        // إضافة إشعار للمستخدم
        if (!$('.char-limit-notice').length) {
          $('<div class="char-limit-notice" style="color: #d9534f; font-size: 14px; margin: 5px 0;">تم تجاوز الحد الأقصى للحروف (200 حرف)</div>').insertAfter($(this));
          setTimeout(function() {
            $('.char-limit-notice').fadeOut(500, function() {
              $(this).remove();
            });
          }, 3000);
        }
      }
    });
    
    // إضافة عداد للحروف
    $('.u-msg').each(function() {
      let $this = $(this);
      let $counter = $('<div class="char-counter" style="font-size: 12px; color: #777; text-align: right; margin-right: 10px;">0/' + maxLength + '</div>');
      $counter.insertAfter($this);
      
      $this.on('input', function() {
        let currentLength = $(this).val().length;
        $counter.text(currentLength + '/' + maxLength);
        
        if (currentLength > maxLength * 0.8) {
          $counter.css('color', '#d9534f');
        } else {
          $counter.css('color', '#777');
        }
      });
    });
    
    // إضافة زر لتحديث الصفحة
    let refreshButton = $("<button>تحديث الصفحة</button>").addClass("btn border refresh-btn").css({
      "background-color": "#5cb85c",
      "color": "white",
      "padding": "10px 15px",
      "margin": "8px",
      "width": "45%",
      "font-size": "16px",
      "border-radius": "10px",
      "box-shadow": "0 2px 5px rgba(0,0,0,0.1)",
      "transition": "all 0.3s ease"
    }).append('<span class="fa fa-refresh" style="margin-right: 5px; font-size: 18px;"></span>').click(function() {
      location.reload();
    });
    
    // إضافة تأثير hover للزر
    refreshButton.hover(
      function() { $(this).css({"background-color": "#4cae4c", "transform": "scale(1.05)"}); },
      function() { $(this).css({"background-color": "#5cb85c", "transform": "scale(1)"}); }
    );
    
    $(".primaryborder").append(refreshButton);
    
    console.log("تم تحميل سكربت شات مدى المطور بنجاح!");
  });
})();
